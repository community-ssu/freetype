# Patch comes from redhat bugzilla (#621144)
--- freetype-2.3.9/src/cff/cffgload.c	2009-03-12 06:41:35.000000000 +0100
+++ freetype-2.3.9-CVE-2010-1797/src/cff/cffgload.c	2012-01-21 13:51:52.345611034 +0100
@@ -203,7 +203,7 @@
     2, /* hsbw */
     0,
     0,
-    0
+    1
   };
 
 
@@ -1964,6 +1964,9 @@
             if ( Rand >= 0x8000L )
               Rand++;
 
+            if ( args - stack >= CFF_MAX_OPERANDS )
+                goto Stack_Overflow;
+
             args[0] = Rand;
             seed    = FT_MulFix( seed, 0x10000L - seed );
             if ( seed == 0 )
@@ -2089,6 +2092,9 @@
         case cff_op_dup:
           FT_TRACE4(( " dup\n" ));
 
+          if ( args + 1 - stack >= CFF_MAX_OPERANDS )
+            goto Stack_Overflow;
+
           args[1] = args[0];
           args++;
           break;
